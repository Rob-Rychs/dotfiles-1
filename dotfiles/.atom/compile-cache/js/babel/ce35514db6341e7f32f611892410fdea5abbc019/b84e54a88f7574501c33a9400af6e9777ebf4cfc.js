Object.defineProperty(exports, '__esModule', {
	value: true
});
/** @babel */

var init = function init() {
	var editor = atom.workspace.getActiveTextEditor();
	if (!editor) {
		return;
	}
	var buffer = editor.getBuffer();
	if (typeof buffer.editorconfig === 'undefined') {
		return;
	}

	var settings = buffer.editorconfig.settings;
	var checkpoint = buffer.createCheckpoint();
	var fixedProperties = {
		end_of_line: 0, // eslint-disable-line camelcase
		indent_style: 0 // eslint-disable-line camelcase
	};

	// fix end_of_line, if necessary
	if (settings.end_of_line !== 'auto') {
		var lastRow = buffer.getLastRow();
		for (var i = 0; i < lastRow; i++) {
			if (buffer.lineEndingForRow(i) !== settings.end_of_line && buffer.lineEndingForRow(i) !== '') {
				buffer.setTextInRange([[i, buffer.lineLengthForRow(i)], [i + 1, 0]], settings.end_of_line, { normalizeLineEndings: false });
				fixedProperties.end_of_line++;
			}
		}
	}

	// fix indent_style, if necessary
	if (settings.indent_style !== 'auto') {
		(function () {
			var softTabs = settings.indent_style === 'space';
			var spaceChar = { 'true': ' ', 'false': '\\t' };
			var tabLength = editor.getTabLength();
			var searchPattern = '^([' + spaceChar[softTabs] + ']*[' + spaceChar[!softTabs] + ']\\s*)';

			if (tabLength > 0) {
				buffer.backwardsScan(new RegExp(searchPattern, 'gm'), function (scan) {
					var displaySize = scan.matchText.split('').reduce(function (prev, curr, index) {
						if (curr === ' ') {
							return prev + 1;
						}
						return prev + tabLength - index % tabLength;
					}, 0);

					// eslint-disable-next-line camelcase
					fixedProperties.indent_style += Math.max(displaySize, Math.floor(displaySize / tabLength));
					if (softTabs) {
						scan.replace(' '.repeat(displaySize));
					} else {
						scan.replace('\t'.repeat(Math.floor(displaySize / tabLength)));
					}
				});
			}
		})();
	}

	// Sum changes up
	var changesInTotal = 0;
	for (var property in fixedProperties) {
		if (({}).hasOwnProperty.call(fixedProperties, property)) {
			changesInTotal += fixedProperties[property];
		}
	}

	// Prepare notification & save changes
	var notificationOptions = { dismissable: true };
	if (changesInTotal > 0) {
		buffer.groupChangesSinceCheckpoint(checkpoint);
		notificationOptions.description = '\n|Fixed EditorConfig-Properties||\n|--------|------:|\n|`end_of_line`|' + fixedProperties.end_of_line + '|\n|`indent_style`|' + fixedProperties.indent_style + '|\n|Changes in total|**' + changesInTotal + '**|\n';
	} else {
		notificationOptions.description = '\nThe file ' + editor.getTitle() + ' conformed to the `end_of_line` and `indent_style` properties.\nNo changes were applied.\n';
	}
	atom.notifications.addSuccess(editor.getTitle(), notificationOptions);
};

var subscriber = function subscriber() {
	atom.commands.add('atom-workspace', 'EditorConfig:fix-file', init);
};

exports['default'] = subscriber;
exports.init = init;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9sYXJzZ3JhdWJuZXIvLmRvdGZpbGVzL2RvdGZpbGVzLy5hdG9tL3BhY2thZ2VzL2VkaXRvcmNvbmZpZy9jb21tYW5kcy9maXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSxJQUFNLElBQUksR0FBRyxTQUFQLElBQUksR0FBUztBQUNsQixLQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUM7QUFDcEQsS0FBSSxDQUFDLE1BQU0sRUFBRTtBQUNaLFNBQU87RUFDUDtBQUNELEtBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNsQyxLQUFJLE9BQU8sTUFBTSxDQUFDLFlBQVksS0FBSyxXQUFXLEVBQUU7QUFDL0MsU0FBTztFQUNQOztBQUVELEtBQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDO0FBQzlDLEtBQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQzdDLEtBQU0sZUFBZSxHQUFHO0FBQ3ZCLGFBQVcsRUFBRSxDQUFDO0FBQ2QsY0FBWSxFQUFFLENBQUM7RUFDZixDQUFDOzs7QUFHRixLQUFJLFFBQVEsQ0FBQyxXQUFXLEtBQUssTUFBTSxFQUFFO0FBQ3BDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUNwQyxPQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ2pDLE9BQUksTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQyxXQUFXLElBQ3RELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7QUFDbkMsVUFBTSxDQUFDLGNBQWMsQ0FDcEIsQ0FDQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxD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QUFDLGdCQUFnQixFQUFFLHVCQUF1QixFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ25FLENBQUM7O3FCQUVNLFVBQVU7UUFBYSxJQUFJLEdBQUosSUFBSSIsImZpbGUiOiIvVXNlcnMvbGFyc2dyYXVibmVyLy5kb3RmaWxlcy9kb3RmaWxlcy8uYXRvbS9wYWNrYWdlcy9lZGl0b3Jjb25maWcvY29tbWFuZHMvZml4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBiYWJlbCAqL1xuXG5jb25zdCBpbml0ID0gKCkgPT4ge1xuXHRjb25zdCBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKCk7XG5cdGlmICghZWRpdG9yKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cdGNvbnN0IGJ1ZmZlciA9IGVkaXRvci5nZXRCdWZmZXIoKTtcblx0aWYgKHR5cGVvZiBidWZmZXIuZWRpdG9yY29uZmlnID09PSAndW5kZWZpbmVkJykge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGNvbnN0IHNldHRpbmdzID0gYnVmZmVyLmVkaXRvcmNvbmZpZy5zZXR0aW5ncztcblx0Y29uc3QgY2hlY2twb2ludCA9IGJ1ZmZlci5jcmVhdGVDaGVja3BvaW50KCk7XG5cdGNvbnN0IGZpeGVkUHJvcGVydGllcyA9IHtcblx0XHRlbmRfb2ZfbGluZTogMCwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRpbmRlbnRfc3R5bGU6IDAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0fTtcblxuXHQvLyBmaXggZW5kX29mX2xpbmUsIGlmIG5lY2Vzc2FyeVxuXHRpZiAoc2V0dGluZ3MuZW5kX29mX2xpbmUgIT09ICdhdXRvJykge1xuXHRcdGNvbnN0IGxhc3RSb3cgPSBidWZmZXIuZ2V0TGFzdFJvdygpO1xuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbGFzdFJvdzsgaSsrKSB7XG5cdFx0XHRpZiAoYnVmZmVyLmxpbmVFbmRpbmdGb3JSb3coaSkgIT09IHNldHRpbmdzLmVuZF9vZl9saW5lICYmXG5cdFx0XHRcdGJ1ZmZlci5saW5lRW5kaW5nRm9yUm93KGkpICE9PSAnJykge1xuXHRcdFx0XHRidWZmZXIuc2V0VGV4dEluUmFuZ2UoXG5cdFx0XHRcdFx0W1xuXHRcdFx0XHRcdFx0W2ksIGJ1ZmZlci5saW5lTGVuZ3RoRm9yUm93KGkpXSxcblx0XHRcdFx0XHRcdFtpICsgMSwgMF1cblx0XHRcdFx0XHRdLFxuXHRcdFx0XHRcdHNldHRpbmdzLmVuZF9vZl9saW5lLFxuXHRcdFx0XHRcdHtub3JtYWxpemVMaW5lRW5kaW5nczogZmFsc2V9XG5cdFx0XHRcdCk7XG5cdFx0XHRcdGZpeGVkUHJvcGVydGllcy5lbmRfb2ZfbGluZSsrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdC8vIGZpeCBpbmRlbnRfc3R5bGUsIGlmIG5lY2Vzc2FyeVxuXHRpZiAoc2V0dGluZ3MuaW5kZW50X3N0eWxlICE9PSAnYXV0bycpIHtcblx0XHRjb25zdCBzb2Z0VGFicyA9IHNldHRpbmdzLmluZGVudF9zdHlsZSA9PT0gJ3NwYWNlJztcblx0XHRjb25zdCBzcGFjZUNoYXIgPSB7dHJ1ZTogJyAnLCBmYWxzZTogJ1xcXFx0J307XG5cdFx0Y29uc3QgdGFiTGVuZ3RoID0gZWRpdG9yLmdldFRhYkxlbmd0aCgpO1xuXHRcdGNvbnN0IHNlYXJjaFBhdHRlcm4gPSBgXihbJHtzcGFjZUNoYXJbc29mdFRhYnNdfV0qWyR7c3BhY2VDaGFyWyFzb2Z0VGFic119XVxcXFxzKilgO1xuXG5cdFx0aWYgKHRhYkxlbmd0aCA+IDApIHtcblx0XHRcdGJ1ZmZlci5iYWNrd2FyZHNTY2FuKG5ldyBSZWdFeHAoc2VhcmNoUGF0dGVybiwgJ2dtJyksIHNjYW4gPT4ge1xuXHRcdFx0XHRjb25zdCBkaXNwbGF5U2l6ZSA9IHNjYW4ubWF0Y2hUZXh0LnNwbGl0KCcnKS5yZWR1Y2UoKHByZXYsIGN1cnIsIGluZGV4KSA9PiB7XG5cdFx0XHRcdFx0aWYgKGN1cnIgPT09ICcgJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIHByZXYgKyAxO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gcHJldiArIHRhYkxlbmd0aCAtIChpbmRleCAlIHRhYkxlbmd0aCk7XG5cdFx0XHRcdH0sIDApO1xuXG5cdFx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2Vcblx0XHRcdFx0Zml4ZWRQcm9wZXJ0aWVzLmluZGVudF9zdHlsZSArPSBNYXRoLm1heChcblx0XHRcdFx0XHRkaXNwbGF5U2l6ZSwgTWF0aC5mbG9vcihkaXNwbGF5U2l6ZSAvIHRhYkxlbmd0aClcblx0XHRcdFx0KTtcblx0XHRcdFx0aWYgKHNvZnRUYWJzKSB7XG5cdFx0XHRcdFx0c2Nhbi5yZXBsYWNlKCcgJy5yZXBlYXQoZGlzcGxheVNpemUpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRzY2FuLnJlcGxhY2UoJ1xcdCcucmVwZWF0KE1hdGguZmxvb3IoZGlzcGxheVNpemUgLyB0YWJMZW5ndGgpKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdC8vIFN1bSBjaGFuZ2VzIHVwXG5cdGxldCBjaGFuZ2VzSW5Ub3RhbCA9IDA7XG5cdGZvciAoY29uc3QgcHJvcGVydHkgaW4gZml4ZWRQcm9wZXJ0aWVzKSB7XG5cdFx0aWYgKHt9Lmhhc093blByb3BlcnR5LmNhbGwoZml4ZWRQcm9wZXJ0aWVzLCBwcm9wZXJ0eSkpIHtcblx0XHRcdGNoYW5nZXNJblRvdGFsICs9IGZpeGVkUHJvcGVydGllc1twcm9wZXJ0eV07XG5cdFx0fVxuXHR9XG5cblx0Ly8gUHJlcGFyZSBub3RpZmljYXRpb24gJiBzYXZlIGNoYW5nZXNcblx0Y29uc3Qgbm90aWZpY2F0aW9uT3B0aW9ucyA9IHtkaXNtaXNzYWJsZTogdHJ1ZX07XG5cdGlmIChjaGFuZ2VzSW5Ub3RhbCA+IDApIHtcblx0XHRidWZmZXIuZ3JvdXBDaGFuZ2VzU2luY2VDaGVja3BvaW50KGNoZWNrcG9pbnQpO1xuXHRcdG5vdGlmaWNhdGlvbk9wdGlvbnMuZGVzY3JpcHRpb24gPSBgXG58Rml4ZWQgRWRpdG9yQ29uZmlnLVByb3BlcnRpZXN8fFxufC0tLS0tLS0tfC0tLS0tLTp8XG58XFxgZW5kX29mX2xpbmVcXGB8JHtmaXhlZFByb3BlcnRpZXMuZW5kX29mX2xpbmV9fFxufFxcYGluZGVudF9zdHlsZVxcYHwke2ZpeGVkUHJvcGVydGllcy5pbmRlbnRfc3R5bGV9fFxufENoYW5nZXMgaW4gdG90YWx8Kioke2NoYW5nZXNJblRvdGFsfSoqfFxuYDtcblx0fSBlbHNlIHtcblx0XHRub3RpZmljYXRpb25PcHRpb25zLmRlc2NyaXB0aW9uID0gYFxuVGhlIGZpbGUgJHtlZGl0b3IuZ2V0VGl0bGUoKX0gY29uZm9ybWVkIHRvIHRoZSBcXGBlbmRfb2ZfbGluZVxcYCBhbmQgXFxgaW5kZW50X3N0eWxlXFxgIHByb3BlcnRpZXMuXG5ObyBjaGFuZ2VzIHdlcmUgYXBwbGllZC5cbmA7XG5cdH1cblx0YXRvbS5ub3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoZWRpdG9yLmdldFRpdGxlKCksIG5vdGlmaWNhdGlvbk9wdGlvbnMpO1xufTtcblxuY29uc3Qgc3Vic2NyaWJlciA9ICgpID0+IHtcblx0YXRvbS5jb21tYW5kcy5hZGQoJ2F0b20td29ya3NwYWNlJywgJ0VkaXRvckNvbmZpZzpmaXgtZmlsZScsIGluaXQpO1xufTtcblxuZXhwb3J0IHtzdWJzY3JpYmVyIGFzIGRlZmF1bHQsIGluaXR9O1xuIl19