#!/usr/bin/env bash
#
# bootstrap installs things.

DOTFILES_ROOT=$(pwd -P)

source "$DOTFILES_ROOT"/scripts/utils.sh

echo ''

# set ZSH as default shell
if [ -z "$ZSH_VERSION" ]
then
    #chsh -s $(grep /zsh$ /etc/shells | tail -1)
    success "Default shell set to ZSH"
fi

# install dotfiles

# setup git
if ! [ -f git/gitconfig.symlink ]
then
    echo ''
    running 'Setting up gitconfig'
    echo ''

    git_credential='cache'
    if [ "$(uname -s)" == "Darwin" ]
    then
      git_credential='osxkeychain'
    fi

    read -p 'Author Name: ' git_authorname
    read -p 'Author E-Mail: ' git_authoremail

    #sed -e "s/AUTHORNAME/$git_authorname/g" -e "s/AUTHOREMAIL/$git_authoremail/g" -e "s/GIT_CREDENTIAL_HELPER/$git_credential/g" "$DOTFILES_ROOT"/git/gitconfig.symlink.example > "$DOTFILES_ROOT"/git/gitconfig.symlink

    echo ''
    success 'gitconfig created'
fi

# install dotfiles
echo ''
info 'installing dotfiles'
echo ''

# @TODO: fix space in path
for src in $(find -H "$DOTFILES_ROOT" -maxdepth 2 -name '*.symlink')
do
    dst="$HOME/.$(basename "${src%.*}")"
done


echo ''
echo 'Finished!'
