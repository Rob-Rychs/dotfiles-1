#!/usr/bin/env bash
#
# Locks the current screen. Only works on OSX!
#
# USAGE:
#
#   $ lock
#

source $DOTFILES/scripts/utils.sh

if [[ "$1" == "-h" || "$1" == "--help" ]]; then cat <<HELP
Dotfiles - Lars Graubner - http://larsgraubner.de

Locks the current screen. Only works on OSX!

Usage: $(basename "$0")

See the README for documentation.
https://github.com/lgraubner/dotfiles

Copyright (c) 2015 Lars Graubner
Licensed under the MIT license.
HELP
exit; fi

if [[ ! is_osx ]]; then
    e_error "This is an OSX only command!"
    exit 1;
fi

sleep 0.5

if [[ "$(ioreg -c AppleSmartBattery | grep '"ExternalConnected" = Yes')" ]]; then
  # Plugged in: start screensaver.
  open /System/Library/Frameworks/ScreenSaver.framework/Versions/A/Resources/ScreenSaverEngine.app
else
  # Battery power: go to lock menu.
  /System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -suspend
fi
