#!/bin/sh
#
# Manages the dotfiles.
#
# USAGE:
#
#   $ dotfiles {install|update|upgrade}
#

set -e

if [[ -z "$1" || "$1" == "-h" || "$1" == "--help" ]]; then cat <<HELP
Dotfiles - Lars Graubner - https://larsgraubner.com

Usage: $(basename "$0") {install|update|upgrade}

See the README for documentation.
https://github.com/lgraubner/dotfiles

Copyright (c) 2017 Lars Graubner
Licensed under the MIT license.
HELP
exit; fi

export DOTFILES=~/.dotfiles

source $DOTFILES/lib/utils.sh

install() {
    installer=$DOTFILES/lib/install.sh
    if [[ -f "$installer" ]]; then
        sh $installer
    else
        e_error "Installer not found"
        exit 1
    fi
    exit
}

update() {
    updater=$DOTFILES/lib/update.sh
    if [[ -f "$updater" ]]; then
        sh "$updater"
    else
        e_error
        exit 1
    fi
    exit

    e_success "Your system is now up to date!"

    exit
}

upgrade() {

    e_line "Fetching latest version..."
    (cd $DOTFILES && git reset --hard HEAD && git pull)

    e_success "dotfiles updated!"

    # reload shell
    exec /bin/zsh -l
}

case $1 in
    install)
        install
        ;;
    update)
        update
        ;;
    upgrade)
        upgrade
        ;;
    *)
        exit 1
esac
